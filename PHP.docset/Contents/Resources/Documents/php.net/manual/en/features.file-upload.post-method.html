<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>POST メソッドによるアップロード</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="features.file-upload.html">ファイルアップロードの処理</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="features.file-upload.errors.html">エラーメッセージの説明</a></div>
 <div class="up"><a href="features.file-upload.html">ファイルアップロードの処理</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="features.file-upload.post-method" class="sect1">
   <h2 class="title">POST メソッドによるアップロード</h2>
   <p class="simpara">
    この機能により、テキスト、バイナリファイルの両方をアップロードできるように
    なります。
    PHP の認証機構およびファイル操作関数を用いて、アップロードを許可する
    ユーザーとアップロード後にそのファイルを使用して行う動作を完全に制御する
    ことが可能です。
   </p>
   <p class="simpara">
    PHP は、全ての RFC-1867 対応ブラウザからファイルのアップロードを
    受けることができます。
   </p>

   <blockquote class="note"><p><strong class="note">注意</strong>: 
    <strong>関係する設定に関する注記</strong><br />
    <p class="para">
     <var class="filename">php.ini</var>の
     <a href="ini.core.html#ini.file-uploads" class="link">file_uploads</a>,
     <a href="ini.core.html#ini.upload-max-filesize" class="link">upload_max_filesize</a>,
     <a href="ini.core.html#ini.upload-tmp-dir" class="link">upload_tmp_dir</a>,
     <a href="ini.core.html#ini.post-max-size" class="link">post_max_size</a>,
     <a href="info.configuration.html#ini.max-input-time" class="link">max_input_time</a>
     ディレクティブも参照ください。
    </p>
   </p></blockquote>

   <p class="para">
    PHP は <span class="productname">Netscape Composer</span> および
    W3C の <span class="productname">Amaya</span> クライアントにより使用される
    PUT メソッドによるファイルアップロードもサポートしています。詳細は、<a href="features.file-upload.put-method.html" class="link">PUT メソッドのサポート
    </a>を参照ください。
   </p>

   <p class="para">
    <div class="example" id="example-383">
     <p><strong>例1 ファイルアップロード用のフォーム</strong></p>
     <div class="example-contents"><p>
      ファイルアップロード画面は、次のような特別なフォームを作成すること
      により、作成することができます。
      </p></div>
     <div class="example-contents">
<div class="htmlcode"><pre class="htmlcode">&lt;!-- データのエンコード方式である enctype は、必ず以下のようにしなければなりません --&gt;
&lt;form enctype=&quot;multipart/form-data&quot; action=&quot;__URL__&quot; method=&quot;POST&quot;&gt;
    &lt;!-- MAX_FILE_SIZE は、必ず &quot;file&quot; input フィールドより前になければなりません --&gt;
    &lt;input type=&quot;hidden&quot; name=&quot;MAX_FILE_SIZE&quot; value=&quot;30000&quot; /&gt;
    &lt;!-- input 要素の name 属性の値が、$_FILES 配列のキーになります --&gt;
    このファイルをアップロード: &lt;input name=&quot;userfile&quot; type=&quot;file&quot; /&gt;
    &lt;input type=&quot;submit&quot; value=&quot;ファイルを送信&quot; /&gt;
&lt;/form&gt;</pre>
</div>
     </div>

     <div class="example-contents"><p>
      上の例の <em>__URL__</em> は、PHP ファイルを指すよう置換される
      必要があります。
     </p></div>
     <div class="example-contents"><p>
      &quot;<em>MAX_FILE_SIZE</em>&quot; hidden フィールドは、
      &quot;file&quot; input フィールドの前に置く必要があります。
      この値は、PHP で取得可能なファイルの最大サイズを規定します。この値はバイト数で指定します。
      <em>MAX_FILE_SIZE</em> は常に指定しておくべきです。
      巨大なファイルを転送しようとして長時間待ち続け、
      結局ファイルが大きすぎて転送できなかったなどといった羽目に陥るのを防げるからです。
      注意: ブラウザ側でこの最大値を出し抜くのは簡単なことなので、この機能を信頼して、
      これより大きなサイズのファイルがブロックされることを前提にしてはいけません。
      しかし、PHP 側の最大サイズの設定を欺くことはできません。
     </p></div>
    </div>
   </p>

   <blockquote class="note"><p><strong class="note">注意</strong>: 
    <p class="para">
      アップロード用のフォームが
      <em>enctype=&quot;multipart/form-data&quot;</em> 属性を有しているかを
      確認してください。さもないと、ファイルのアップロードは動作しません。
    </p>
   </p></blockquote>

   <p class="para">
    グローバルの <var class="varname"><var class="varname"><a href="reserved.variables.files.html" class="classname">$_FILES</a></var></var> には、アップロードされたファイルの情報が含まれます。
    サンプルのフォームからの内容は次のようになります。ここでは、上の例のスクリプトで使われたように、
    アップロードファイルの名前として <em class="emphasis">userfile</em> を
    使用することを仮定していることに注意してください。
    実際にはどんな名前にすることもできます。
    <dl>

     
      <dt>
<var class="varname"><var class="varname"><a href="reserved.variables.files.html" class="classname">$_FILES['userfile']['name']</a></var></var></dt>

      <dd>

       <p class="para">
        クライアントマシンの元のファイル名。
       </p>
      </dd>

     
     
      <dt>
<var class="varname"><var class="varname"><a href="reserved.variables.files.html" class="classname">$_FILES['userfile']['type']</a></var></var></dt>

      <dd>

       <p class="para">
        ファイルの MIME 型。ただし、ブラウザがこの情報を提供する場合。
        例えば、<em>&quot;image/gif&quot;</em> のようになります。
        この MIME 型は PHP 側ではチェックされません。そのため、
        この値は信用できません。
       </p>
      </dd>

     
     
      <dt>
<var class="varname"><var class="varname"><a href="reserved.variables.files.html" class="classname">$_FILES['userfile']['size']</a></var></var></dt>

      <dd>

       <p class="para">
        アップロードされたファイルのバイト単位のサイズ。
       </p>
      </dd>

     
     
      <dt>
<var class="varname"><var class="varname"><a href="reserved.variables.files.html" class="classname">$_FILES['userfile']['tmp_name']</a></var></var></dt>

      <dd>

       <p class="para">
        アップロードされたファイルがサーバー上で保存されているテンポラ
        リファイルの名前。
       </p>
      </dd>

     
     
      <dt>
<var class="varname"><var class="varname"><a href="reserved.variables.files.html" class="classname">$_FILES['userfile']['error']</a></var></var></dt>

      <dd>

       <p class="para">
        このファイルアップロードに関する
        <a href="features.file-upload.errors.html" class="link">エラーコード</a>
       </p>
      </dd>

     
    </dl>

   </p>

   <p class="para">
    <var class="filename">php.ini</var> の <a href="ini.core.html#ini.upload-tmp-dir" class="link">upload_tmp_dir</a> ディレクティブで
    他の場所を指定しない限り、ファイルはサーバーにおけるデフォルトの
    テンポラリディレクトリに保存されます。サーバーのデフォルトディレクトリは、
    PHP を実行する環境において環境変数 <span class="envar">TMPDIR</span> を設定する
    ことにより変更することができます。しかし、PHP スクリプトの内部から
    <span class="function"><a href="function.putenv.html" class="function">putenv()</a></span> 関数により設定しても上手くいきません。
    この環境変数は、アップロードされたファイルに他の処理を行う際にも
    同様に使用することが可能です。
    <div class="example" id="example-384">
     <p><strong>例2 ファイルのアップロードを検証する</strong></p>
     <div class="example-contents"><p>
      詳細については、<span class="function"><a href="function.is-uploaded-file.html" class="function">is_uploaded_file()</a></span>
      および <span class="function"><a href="function.move-uploaded-file.html" class="function">move_uploaded_file()</a></span> の関数のエントリも
      参照ください。以下はフォームからファイルをアップロードするプロセスの例です。
     </p></div>
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;4.1.0より前のPHPでは$FILESの代わりに$HTTP_POST_FILESを使用する必要<br />//&nbsp;があります。<br /><br /></span><span style="color: #0000BB">$uploaddir&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'/var/www/uploads/'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$uploadfile&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$uploaddir&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">basename</span><span style="color: #007700">(</span><span style="color: #0000BB">$_FILES</span><span style="color: #007700">[</span><span style="color: #DD0000">'userfile'</span><span style="color: #007700">][</span><span style="color: #DD0000">'name'</span><span style="color: #007700">]);<br /><br />echo&nbsp;</span><span style="color: #DD0000">'&lt;pre&gt;'</span><span style="color: #007700">;<br />if&nbsp;(</span><span style="color: #0000BB">move_uploaded_file</span><span style="color: #007700">(</span><span style="color: #0000BB">$_FILES</span><span style="color: #007700">[</span><span style="color: #DD0000">'userfile'</span><span style="color: #007700">][</span><span style="color: #DD0000">'tmp_name'</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$uploadfile</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"File&nbsp;is&nbsp;valid,&nbsp;and&nbsp;was&nbsp;successfully&nbsp;uploaded.\n"</span><span style="color: #007700">;<br />}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Possible&nbsp;file&nbsp;upload&nbsp;attack!\n"</span><span style="color: #007700">;<br />}<br /><br />echo&nbsp;</span><span style="color: #DD0000">'Here&nbsp;is&nbsp;some&nbsp;more&nbsp;debugging&nbsp;info:'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$_FILES</span><span style="color: #007700">);<br /><br />print&nbsp;</span><span style="color: #DD0000">"&lt;/pre&gt;"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

    </div>
   </p>
   <p class="simpara">
    アップロードされたファイルを受け取る PHP スクリプトは、アップロード
    されたファイルを用いて何をするべきかを決めるために必要なロジックを
    全て実装する必要があります。例えば、変数
    <var class="varname"><var class="varname"><a href="reserved.variables.files.html" class="classname">$_FILES['userfile']['size']</a></var></var> を使用して、小さすぎたり
    大きすぎたりするファイルを捨てることができます。指定した型以外の
    ファイルを全て捨てるために変数
    <var class="varname"><var class="varname"><a href="reserved.variables.files.html" class="classname">$_FILES['userfile']['type']</a></var></var> を用いることができますが、
    これはあくまでいくつかのチェックの中のひとつとしてのみ実行するように
    してください。なぜなら、この値を設定するのはあくまでもクライアントであり、
    PHP 側では何もチェックしていないからです。
    また、
    <var class="varname"><var class="varname"><a href="reserved.variables.files.html" class="classname">$_FILES['userfile']['error']</a></var></var> を使用することができ、
    <a href="features.file-upload.errors.html" class="link">エラーコード</a>
    に基づき、ロジックを構成することができます。
    何らかの方法により、テンポラリディレクトリからファイルを削除したり
    他の場所に移動したりする必要があります。
   </p>
   <p class="simpara">
    フォームでアップロードされるファイルが選択されていない場合、PHP は
    <var class="varname"><var class="varname"><a href="reserved.variables.files.html" class="classname">$_FILES['userfile']['size']</a></var></var> として 0 を返し、
    <var class="varname"><var class="varname"><a href="reserved.variables.files.html" class="classname">$_FILES['userfile']['tmp_name']</a></var></var> には値を
    設定しません。
   </p>
   <p class="simpara">
    移動または名前の変更が行われていない場合、リクエストの終了時に
    そのファイルはテンポラリディレクトリから削除されます。
   </p>
    <div class="example" id="example-385">
     <p><strong>例3 ファイルの配列をアップロードする</strong></p>
     <div class="example-contents"><p>
      PHP はファイルについても
      <a href="faq.html.html#faq.html.arrays" class="link">HTML フォームで配列を使用すること</a>
      をサポートしています。
     </p></div>
     <div class="example-contents">
<div class="htmlcode"><pre class="htmlcode">&lt;form action=&quot;&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
&lt;p&gt;Pictures:
&lt;input type=&quot;file&quot; name=&quot;pictures[]&quot; /&gt;
&lt;input type=&quot;file&quot; name=&quot;pictures[]&quot; /&gt;
&lt;input type=&quot;file&quot; name=&quot;pictures[]&quot; /&gt;
&lt;input type=&quot;submit&quot; value=&quot;Send&quot; /&gt;
&lt;/p&gt;
&lt;/form&gt;</pre>
</div>
     </div>

     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">foreach&nbsp;(</span><span style="color: #0000BB">$_FILES</span><span style="color: #007700">[</span><span style="color: #DD0000">"pictures"</span><span style="color: #007700">][</span><span style="color: #DD0000">"error"</span><span style="color: #007700">]&nbsp;as&nbsp;</span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$error</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$error&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">UPLOAD_ERR_OK</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$tmp_name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_FILES</span><span style="color: #007700">[</span><span style="color: #DD0000">"pictures"</span><span style="color: #007700">][</span><span style="color: #DD0000">"tmp_name"</span><span style="color: #007700">][</span><span style="color: #0000BB">$key</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;basename()&nbsp;で、ひとまずファイルシステムトラバーサル攻撃は防げるでしょう。<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;ファイル名についてのその他のバリデーションも、適切に行いましょう。<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">basename</span><span style="color: #007700">(</span><span style="color: #0000BB">$_FILES</span><span style="color: #007700">[</span><span style="color: #DD0000">"pictures"</span><span style="color: #007700">][</span><span style="color: #DD0000">"name"</span><span style="color: #007700">][</span><span style="color: #0000BB">$key</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">move_uploaded_file</span><span style="color: #007700">(</span><span style="color: #0000BB">$tmp_name</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"data/</span><span style="color: #0000BB">$name</span><span style="color: #DD0000">"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

    </div>
   <p class="para">
    ファイルアップロードのプログレスバーは、<a href="session.upload-progress.html" class="link">セッションのアップロードの進捗</a>
    で実装することができます。
   </p>
  </div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="120868""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#120868" class="date">25-Mar-2017 07:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
&lt;html&gt;<br />
&lt;h1&gt; Email Bomber Script&lt;/h1&gt;<br />
&lt;/html&gt;<br />
<br />
&lt;table border=2&gt;<br />
&lt;form action="" method=post&gt;<br />
&lt;tr&gt;&lt;td&gt;Targat Email Address: &lt;/td&gt;&lt;td&gt;&lt;input type=text name=email size=30&gt;&lt;/td&gt;&lt;/tr&gt;<br />
&lt;tr&gt;&lt;td&gt;Sender name: &lt;/td&gt;&lt;td&gt;&lt;input type=text name=name size=30&gt;&lt;/td&gt;&lt;/tr&gt;<br />
&lt;tr&gt;&lt;td&gt;Sender Email Address: &lt;/td&gt;&lt;td&gt;&lt;input type=text name=sender size=30&gt;&lt;/td&gt;&lt;/tr&gt;<br />
&lt;tr&gt;&lt;td&gt;Subject: &lt;/td&gt;&lt;td&gt;&lt;input type=text name=subject size=30&gt;&lt;/td&gt;&lt;/tr&gt;<br />
&lt;tr&gt;&lt;td&gt;Content: &lt;/td&gt;&lt;td&gt;&lt;textarea rows=10 cols=30 name=content&gt;&lt;/textarea&gt;&lt;/td&gt;&lt;/tr&gt;<br />
&lt;tr&gt;&lt;td&gt;&lt;input type=submit value="Send Mail"&gt;&lt;/td&gt;&lt;/tr&gt;<br />
&lt;/form&gt;<br />
&lt;/table&gt;<br />
<br />
<span class="default">&lt;?php<br />
$to </span><span class="keyword">= </span><span class="string">'indianhacker@example.com'</span><span class="keyword">;<br />
</span><span class="default">$subject </span><span class="keyword">= </span><span class="string">'the subject'</span><span class="keyword">;<br />
</span><span class="default">$message </span><span class="keyword">= </span><span class="string">'hello'</span><span class="keyword">;<br />
</span><span class="default">$headers </span><span class="keyword">= </span><span class="string">'From: webmaster@example.com' </span><span class="keyword">. </span><span class="string">"\r\n" </span><span class="keyword">.<br />
</span><span class="string">'Reply-To: webmaster@example.com' </span><span class="keyword">. </span><span class="string">"\r\n" </span><span class="keyword">.<br />
</span><span class="string">'X-Mailer: PHP/' </span><span class="keyword">. </span><span class="default">phpversion</span><span class="keyword">();<br />
<br />
for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt;= </span><span class="default">500</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
{<br />
</span><span class="default">mail</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">, </span><span class="default">$headers </span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="120867""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#120867" class="date">25-Mar-2017 07:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
&lt;html&gt;<br />
&lt;h1&gt; Email Bomber Script&lt;/h1&gt;<br />
&lt;/html&gt;<br />
<br />
&lt;table border=2&gt;<br />
&lt;form action="" method=post&gt;<br />
&lt;tr&gt;&lt;td&gt;Targat Email Address: &lt;/td&gt;&lt;td&gt;&lt;input type=text name=email size=30&gt;&lt;/td&gt;&lt;/tr&gt;<br />
&lt;tr&gt;&lt;td&gt;Sender name: &lt;/td&gt;&lt;td&gt;&lt;input type=text name=name size=30&gt;&lt;/td&gt;&lt;/tr&gt;<br />
&lt;tr&gt;&lt;td&gt;Sender Email Address: &lt;/td&gt;&lt;td&gt;&lt;input type=text name=sender size=30&gt;&lt;/td&gt;&lt;/tr&gt;<br />
&lt;tr&gt;&lt;td&gt;Subject: &lt;/td&gt;&lt;td&gt;&lt;input type=text name=subject size=30&gt;&lt;/td&gt;&lt;/tr&gt;<br />
&lt;tr&gt;&lt;td&gt;Content: &lt;/td&gt;&lt;td&gt;&lt;textarea rows=10 cols=30 name=content&gt;&lt;/textarea&gt;&lt;/td&gt;&lt;/tr&gt;<br />
&lt;tr&gt;&lt;td&gt;&lt;input type=submit value="Send Mail"&gt;&lt;/td&gt;&lt;/tr&gt;<br />
&lt;/form&gt;<br />
&lt;/table&gt;<br />
<br />
<span class="default">&lt;?php<br />
$to </span><span class="keyword">= </span><span class="string">'indianhacker@example.com'</span><span class="keyword">;<br />
</span><span class="default">$subject </span><span class="keyword">= </span><span class="string">'the subject'</span><span class="keyword">;<br />
</span><span class="default">$message </span><span class="keyword">= </span><span class="string">'hello'</span><span class="keyword">;<br />
</span><span class="default">$headers </span><span class="keyword">= </span><span class="string">'From: webmaster@example.com' </span><span class="keyword">. </span><span class="string">"\r\n" </span><span class="keyword">.<br />
</span><span class="string">'Reply-To: webmaster@example.com' </span><span class="keyword">. </span><span class="string">"\r\n" </span><span class="keyword">.<br />
</span><span class="string">'X-Mailer: PHP/' </span><span class="keyword">. </span><span class="default">phpversion</span><span class="keyword">();<br />
<br />
for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt;= </span><span class="default">500</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
{<br />
</span><span class="default">mail</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">, </span><span class="default">$headers </span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="120686""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#120686" class="date">22-Feb-2017 07:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have found it useful to re-order the multidimensional $_FILES array into a more intuitive format, as proposed by many other developers already. <br />
<br />
Unfortunately, most of the proposed functions are not able to re-order the $_FILES array when it has more than 1 additional dimension.<br />
<br />
Therefore, I would like to contribute the function below, which is capable of meeting the aforementioned requirement:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">get_fixed_files</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$function </span><span class="keyword">= function(</span><span class="default">$files</span><span class="keyword">, </span><span class="default">$fixed_files </span><span class="keyword">= array(), </span><span class="default">$path </span><span class="keyword">= array()) use (&amp;</span><span class="default">$function</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$files </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">= </span><span class="default">$path</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp</span><span class="keyword">[] = </span><span class="default">$key</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fixed_files </span><span class="keyword">= </span><span class="default">$function</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">, </span><span class="default">$fixed_files</span><span class="keyword">, </span><span class="default">$temp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$next </span><span class="keyword">= </span><span class="default">array_splice</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">= </span><span class="default">array_merge</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">, </span><span class="default">$next</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new </span><span class="keyword">= &amp;</span><span class="default">$fixed_files</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$temp </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new </span><span class="keyword">= &amp;</span><span class="default">$new</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new </span><span class="keyword">= </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$fixed_files</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; };<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$function</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
Side note: the unnamed function within the function is used to avoid confusion regarding the arguments necessary for the recursion within the function, for example when viewing the function in an IDE.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="119786""></a>
  <div class="note">
   <strong class="user">russianhacker</strong>
   <a href="#119786" class="date">25-Aug-2016 10:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
function normalize_files_array($files = []) {<br />
<br />
&nbsp;&nbsp;&nbsp; $arr = [];<br />
<br />
&nbsp;&nbsp;&nbsp; foreach ($files['name'] as $index =&gt; $filename) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $arr[] = array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'name' =&gt; $filename,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'tmp_name' =&gt; $files['tmp_name'][$index],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'error' =&gt; $files['error'][$index],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'size' =&gt; $files['size'][$index],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'type' =&gt; $files['type'][$index]<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; );<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return $arr;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="119643""></a>
  <div class="note">
   <strong class="user">mpyw</strong>
   <a href="#119643" class="date">24-Jul-2016 03:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Do not use Coreywelch or Daevid's way, because their methods can handle only within two-dimensional structure. $_FILES can consist of any hierarchy, such as 3d or 4d structure.<br />
<br />
The following example form breaks their codes:<br />
<br />
&lt;form action="" method="post" enctype="multipart/form-data"&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;input type="file" name="files[x][y][z]"&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;input type="submit"&gt;<br />
&lt;/form&gt;<br />
<br />
As the solution, you should use PSR-7 based zendframework/zend-diactoros.<br />
<br />
GitHub:<br />
<br />
https://github.com/zendframework/zend-diactoros<br />
<br />
Example:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">use </span><span class="default">Psr</span><span class="keyword">\</span><span class="default">Http</span><span class="keyword">\</span><span class="default">Message</span><span class="keyword">\</span><span class="default">UploadedFileInterface</span><span class="keyword">;<br />
use </span><span class="default">Zend</span><span class="keyword">\</span><span class="default">Diactoros</span><span class="keyword">\</span><span class="default">ServerRequestFactory</span><span class="keyword">;<br />
<br />
</span><span class="default">$request </span><span class="keyword">= </span><span class="default">ServerRequestFactory</span><span class="keyword">::</span><span class="default">fromGlobals</span><span class="keyword">();<br />
<br />
if (</span><span class="default">$request</span><span class="keyword">-&gt;</span><span class="default">getMethod</span><span class="keyword">() !== </span><span class="string">'POST'</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">http_response_code</span><span class="keyword">(</span><span class="default">405</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; exit(</span><span class="string">'Use POST method.'</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$uploaded_files </span><span class="keyword">= </span><span class="default">$request</span><span class="keyword">-&gt;</span><span class="default">getUploadedFiles</span><span class="keyword">();<br />
<br />
if (<br />
&nbsp;&nbsp;&nbsp; !isset(</span><span class="default">$uploaded_files</span><span class="keyword">[</span><span class="string">'files'</span><span class="keyword">][</span><span class="string">'x'</span><span class="keyword">][</span><span class="string">'y'</span><span class="keyword">][</span><span class="string">'z'</span><span class="keyword">]) ||<br />
&nbsp;&nbsp;&nbsp; !</span><span class="default">$uploaded_files</span><span class="keyword">[</span><span class="string">'files'</span><span class="keyword">][</span><span class="string">'x'</span><span class="keyword">][</span><span class="string">'y'</span><span class="keyword">][</span><span class="string">'z'</span><span class="keyword">] instanceof </span><span class="default">UploadedFileInterface<br />
</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">http_response_code</span><span class="keyword">(</span><span class="default">400</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; exit(</span><span class="string">'Invalid request body.'</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$file </span><span class="keyword">= </span><span class="default">$uploaded_files</span><span class="keyword">[</span><span class="string">'files'</span><span class="keyword">][</span><span class="string">'x'</span><span class="keyword">][</span><span class="string">'y'</span><span class="keyword">][</span><span class="string">'z'</span><span class="keyword">];<br />
<br />
if (</span><span class="default">$file</span><span class="keyword">-&gt;</span><span class="default">getError</span><span class="keyword">() !== </span><span class="default">UPLOAD_ERR_OK</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">http_response_code</span><span class="keyword">(</span><span class="default">400</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; exit(</span><span class="string">'File uploading failed.'</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$file</span><span class="keyword">-&gt;</span><span class="default">moveTo</span><span class="keyword">(</span><span class="string">'/path/to/new/file'</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118858""></a>
  <div class="note">
   <strong class="user">coreywelch+phpnet at gmail dot com</strong>
   <a href="#118858" class="date">18-Feb-2016 07:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The documentation doesn't have any details about how the HTML array feature formats the $_FILES array. <br />
<br />
Example $_FILES array:<br />
<br />
For single file -<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [document] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; sample-file.doc<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [type] =&gt; application/msword<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [tmp_name] =&gt; /tmp/path/phpVGCDAJ<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [error] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [size] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
)<br />
<br />
Multi-files with HTML array feature -<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [documents] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; sample-file.doc<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; sample-file.doc<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [type] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; application/msword<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; application/msword<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [tmp_name] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; /tmp/path/phpVGCDAJ<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; /tmp/path/phpVGCDAJ<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [error] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [size] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
)<br />
<br />
The problem occurs when you have a form that uses both single file and HTML array feature. The array isn't normalized and tends to make coding for it really sloppy. I have included a nice method to normalize the $_FILES array.<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">normalize_files_array</span><span class="keyword">(</span><span class="default">$files </span><span class="keyword">= []) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$normalized_array </span><span class="keyword">= [];<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$files </span><span class="keyword">as </span><span class="default">$index </span><span class="keyword">=&gt; </span><span class="default">$file</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$normalized_array</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">][] = </span><span class="default">$file</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$file</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">] as </span><span class="default">$idx </span><span class="keyword">=&gt; </span><span class="default">$name</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$normalized_array</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">][</span><span class="default">$idx</span><span class="keyword">] = [<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'name' </span><span class="keyword">=&gt; </span><span class="default">$name</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'type' </span><span class="keyword">=&gt; </span><span class="default">$file</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">][</span><span class="default">$idx</span><span class="keyword">],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'tmp_name' </span><span class="keyword">=&gt; </span><span class="default">$file</span><span class="keyword">[</span><span class="string">'tmp_name'</span><span class="keyword">][</span><span class="default">$idx</span><span class="keyword">],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'error' </span><span class="keyword">=&gt; </span><span class="default">$file</span><span class="keyword">[</span><span class="string">'error'</span><span class="keyword">][</span><span class="default">$idx</span><span class="keyword">],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'size' </span><span class="keyword">=&gt; </span><span class="default">$file</span><span class="keyword">[</span><span class="string">'size'</span><span class="keyword">][</span><span class="default">$idx</span><span class="keyword">]<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$normalized_array</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
The following is the output from the above method.<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [document] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; sample-file.doc<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [type] =&gt; application/msword<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [tmp_name] =&gt; /tmp/path/phpVGCDAJ<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [error] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [size] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp;&nbsp; [documents] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; sample-file.doc<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [type] =&gt; application/msword<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [tmp_name] =&gt; /tmp/path/phpVGCDAJ<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [error] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [size] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; sample-file.doc<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [type] =&gt; application/msword<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [tmp_name] =&gt; /tmp/path/phpVGCDAJ<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [error] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [size] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117613""></a>
  <div class="note">
   <strong class="user">anon</strong>
   <a href="#117613" class="date">08-Jul-2015 07:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For clarity; the reason you would NOT want to replace the example script with<br />
$uploaddir = './';<br />
is because if you have no coded file constraints a nerd could upload a php script with the same name of one of your scripts in the scripts directory.<br />
<br />
Given the right settings and permissions php-cgi is capable of replacing even php files.<br />
<br />
Imagine if it replaced the upload post processor file itself. The next "upload" could lead to some easy exploits.<br />
<br />
Even when replacements are not possible; uploading an .htaccess file could cause some problems, especially if it is sent after the nerd throws in a devious script to use htaccess to redirect to his upload.<br />
<br />
There are probably more ways of exploiting it. Don't let the nerds get you.<br />
<br />
More sensible to use a fresh directory for uploads with some form of unique naming algorithm; maybe even a cron job for sanitizing the directory so older files do not linger for too long.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116393""></a>
  <div class="note">
   <strong class="user">bimal at sanjaal dot com</strong>
   <a href="#116393" class="date">26-Dec-2014 08:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Some suggestions here:<br />
<br />
1. It is always better to check for your error status. If MAX_FILE_SIZE is active and the uploaded file crossed the limit, it will set the error. So, only when error is zero (0), move the file.<br />
<br />
2. If possible, never allow your script to upload in the path where file can be downloaded. Point your upload path to outside of public_html area or prevent direct browsing (using .htaccess restrictions). Think, if someone uploads malicious code, specially php codes, they will be executed on the server.<br />
<br />
3. Do not use the file name sent by the client. Regenerate a new name for newly uploaded file. This prevents overwriting your old files.<br />
<br />
4. Regularly track the disk space consumed, if you are running out of storage.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116246""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#116246" class="date">30-Nov-2014 02:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For the love of god, don't do what michael suggests in <a href="http://php.net/manual/en/features.file-upload.post-method.php#94973 or you will be instantly pwned by someone uploading a php-shell to your script dir." rel="nofollow" target="_blank">http://php.net/manual/en/features.file-upload.post-method.php#94973 or you will be instantly pwned by someone uploading a php-shell to your script dir.</a><br />
<br />
When the mods come to delete this note for violating the don't-refer-to-another-note rule, please please /please/ delete michael's note too.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111561""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#111561" class="date">05-Mar-2013 03:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Normalizing $_FILES structure:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $files </span><span class="keyword">= [];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fix </span><span class="keyword">= function (&amp;</span><span class="default">$files</span><span class="keyword">, </span><span class="default">$values</span><span class="keyword">, </span><span class="default">$prop</span><span class="keyword">) use (&amp;</span><span class="default">$fix</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$values </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fix</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">], </span><span class="default">$value</span><span class="keyword">, </span><span class="default">$prop</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$files</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">][</span><span class="default">$prop</span><span class="keyword">] = </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; };<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$_FILES </span><span class="keyword">as </span><span class="default">$name </span><span class="keyword">=&gt; </span><span class="default">$props</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$props </span><span class="keyword">as </span><span class="default">$prop </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fix</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">], </span><span class="default">$value</span><span class="keyword">, </span><span class="default">$prop</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$files</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">][</span><span class="default">$prop</span><span class="keyword">] = </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104349""></a>
  <div class="note">
   <strong class="user">Age Bosma</strong>
   <a href="#104349" class="date">10-Jun-2011 11:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
"If no file is selected for upload in your form, PHP will return $_FILES['userfile']['size'] as 0, and $_FILES['userfile']['tmp_name'] as none."<br />
<br />
Note that the situation above is the same when a file exceeding the MAX_FILE_SIZE hidden field is being uploaded. In this case $_FILES['userfile']['size'] is also set to 0, and $_FILES['userfile']['tmp_name'] is also empty. The difference would only be the error code.<br />
Simply checking for these two conditions and assuming no file upload has been attempted is incorrect.<br />
<br />
Instead, check if $_FILES['userfile']['name'] is set or not. If it is, a file upload has at least been attempted (a failed attempt or not). If it is not set, no attempt has been made.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100187""></a>
  <div class="note">
   <strong class="user">Mark</strong>
   <a href="#100187" class="date">30-Sep-2010 01:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
$_FILES will be empty if a user attempts to upload a file greater than post_max_size in your php.ini<br />
<br />
post_max_size should be &gt;= upload_max_filesize in your php.ini.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91479""></a>
  <div class="note">
   <strong class="user">daevid at daevid dot com</strong>
   <a href="#91479" class="date">11-Jun-2009 11:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I think the way an array of attachments works is kind of cumbersome. Usually the PHP guys are right on the money, but this is just counter-intuitive. It should have been more like:<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; facepalm.jpg<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [type] =&gt; image/jpeg<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [tmp_name] =&gt; /tmp/phpn3FmFr<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [error] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [size] =&gt; 15476<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp;&nbsp; [1] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [type] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [tmp_name] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [error] =&gt; 4<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [size] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
)<br />
<br />
and not this<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [name] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; facepalm.jpg<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp;&nbsp; [type] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; image/jpeg<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp;&nbsp; [tmp_name] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; /tmp/phpn3FmFr<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp;&nbsp; [error] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; 4<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp;&nbsp; [size] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; 15476<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
)<br />
<br />
Anyways, here is a fuller example than the sparce one in the documentation above:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">foreach (</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">"attachment"</span><span class="keyword">][</span><span class="string">"error"</span><span class="keyword">] as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$error</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_name </span><span class="keyword">= </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">"attachment"</span><span class="keyword">][</span><span class="string">"tmp_name"</span><span class="keyword">][</span><span class="default">$key</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; if (!</span><span class="default">$tmp_name</span><span class="keyword">) continue;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$name </span><span class="keyword">= </span><span class="default">basename</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">"attachment"</span><span class="keyword">][</span><span class="string">"name"</span><span class="keyword">][</span><span class="default">$key</span><span class="keyword">]);<br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$error </span><span class="keyword">== </span><span class="default">UPLOAD_ERR_OK</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$tmp_name</span><span class="keyword">, </span><span class="string">"/tmp/"</span><span class="keyword">.</span><span class="default">$name</span><span class="keyword">) )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$uploaded_array</span><span class="keyword">[] .= </span><span class="string">"Uploaded file '"</span><span class="keyword">.</span><span class="default">$name</span><span class="keyword">.</span><span class="string">"'.&lt;br/&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$errormsg </span><span class="keyword">.= </span><span class="string">"Could not move uploaded file '"</span><span class="keyword">.</span><span class="default">$tmp_name</span><span class="keyword">.</span><span class="string">"' to '"</span><span class="keyword">.</span><span class="default">$name</span><span class="keyword">.</span><span class="string">"'&lt;br/&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else </span><span class="default">$errormsg </span><span class="keyword">.= </span><span class="string">"Upload error. ["</span><span class="keyword">.</span><span class="default">$error</span><span class="keyword">.</span><span class="string">"] on file '"</span><span class="keyword">.</span><span class="default">$name</span><span class="keyword">.</span><span class="string">"'&lt;br/&gt;\n"</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89938""></a>
  <div class="note">
   <strong class="user">eslindsey at gmail dot com</strong>
   <a href="#89938" class="date">30-Mar-2009 08:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Also note that since MAX_FILE_SIZE hidden field is supplied by the browser doing the submitting, it is easily overridden from the clients' side.&nbsp; You should always perform your own examination and error checking of the file after it reaches you, instead of relying on information submitted by the client.&nbsp; This includes checks for file size (always check the length of the actual data versus the reported file size) as well as file type (the MIME type submitted by the browser can be inaccurate at best, and intentionally set to an incorrect value at worst).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89697""></a>
  <div class="note">
   <strong class="user">claude dot pache at gmail dot com</strong>
   <a href="#89697" class="date">19-Mar-2009 06:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that the MAX_FILE_SIZE hidden field is only used by the PHP script which receives the request, as an instruction to reject files larger than the given bound. This field has no significance for the browser, it does not provide a client-side check of the file-size, and it has nothing to do with web standards or browser features.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="features.file-upload.html">ファイルアップロードの処理</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="features.file-upload.errors.html">エラーメッセージの説明</a></div>
 <div class="up"><a href="features.file-upload.html">ファイルアップロードの処理</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
