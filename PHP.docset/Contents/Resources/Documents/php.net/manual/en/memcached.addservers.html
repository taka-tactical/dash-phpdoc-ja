<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>複数のサーバーをサーバープールに追加する</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="memcached.addserver.html">Memcached::addServer</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="memcached.append.html">Memcached::append</a></div>
 <div class="up"><a href="class.memcached.html">Memcached</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="memcached.addservers" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">Memcached::addServers</h1>
  <p class="verinfo">(PECL memcached &gt;= 0.1.1)</p><p class="refpurpose"><span class="refname">Memcached::addServers</span> &mdash; <span class="dc-title">複数のサーバーをサーバープールに追加する</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-memcached.addservers-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="type">bool</span> <span class="methodname"><strong>Memcached::addServers</strong></span>
    ( <span class="methodparam"><span class="type">array</span> <code class="parameter">$servers</code></span>
   )</div>

  <p class="para rdfs-comment">
   <span class="function"><strong>Memcached::addServers()</strong></span> は、
   <code class="parameter">servers</code> をサーバープールに追加します。
   <code class="parameter">servers</code> の各エントリは、
   個々のサーバーのホスト名、ポート、重み (オプション) を含む配列となります。
   この時点では、サーバーへの接続は確立されません。
  </p>
  <p class="para">
   同じサーバーがサーバープール内で複数回あらわれることもあります。
   重複チェックはしていないからです。これは望ましい状態ではありません。
   その代わりに <code class="parameter">weight</code> オプションを使用して、
   このサーバーを選択する重みを増やします。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-memcached.addservers-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">array</code></dt>

     <dd>

      <p class="para">
       プールに追加するサーバーの配列。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-memcached.addservers-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   成功した場合に <strong><code>TRUE</code></strong> を、失敗した場合に <strong><code>FALSE</code></strong> を返します。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-memcached.addservers-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-5003">
    <p><strong>例1 <span class="function"><strong>Memcached::addServers()</strong></span> の例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$m&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Memcached</span><span style="color: #007700">();<br /><br /></span><span style="color: #0000BB">$servers&nbsp;</span><span style="color: #007700">=&nbsp;array(<br />&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'mem1.domain.com'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">11211</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">33</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'mem2.domain.com'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">11211</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">67</span><span style="color: #007700">)<br />);<br /></span><span style="color: #0000BB">$m</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addServers</span><span style="color: #007700">(</span><span style="color: #0000BB">$servers</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-memcached.addservers-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="methodname"><a href="memcached.addserver.html" class="methodname" rel="rdfs-seeAlso">Memcached::addServer()</a> - サーバーをサーバープールに追加する</span></li>
    <li class="member"><span class="methodname"><a href="memcached.resetserverlist.html" class="methodname" rel="rdfs-seeAlso">Memcached::resetServerList()</a> - サーバーリストからすべてのサーバーを消去する</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="118940""></a>
  <div class="note">
   <strong class="user">Aliaser</strong>
   <a href="#118940" class="date">03-Mar-2016 04:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For a proper FailOver mechanism:<br />
<br />
$memcached = new Memcached();<br />
$memcached-&gt;setOption(Memcached::OPT_CONNECT_TIMEOUT, 10);<br />
$memcached-&gt;setOption(Memcached::OPT_DISTRIBUTION, Memcached::DISTRIBUTION_CONSISTENT);<br />
$memcached-&gt;setOption(Memcached::OPT_SERVER_FAILURE_LIMIT, 2);<br />
$memcached-&gt;setOption(Memcached::OPT_REMOVE_FAILED_SERVERS, true);<br />
$memcached-&gt;setOption(Memcached::OPT_RETRY_TIMEOUT, 1);<br />
$memcached-&gt;addServers($servers);<br />
<br />
Memcached::OPT_DISTRIBUTION: set it to consistent hashing. If one memcached node is dead, its keys (and only its keys) will be evenly distributed to other nodes. This is where the magic is done. This is really different from removing one server in your -&gt;addServers() call.<br />
<br />
Memcached::OPT_SERVER_FAILURE_LIMIT: number of connection issues before a server is marked as DEAD, and removed from the list of servers (default: 5).<br />
<br />
Memcached::OPT_REMOVE_FAILED_SERVERS: set it to ≪true≫, to enable the removal of dead servers.<br />
<br />
Memcached::OPT_RETRY_TIMEOUT: after a node is declared DEAD, libmemcached will try it again after that many seconds. Here I've set it to 1 second, but I'm working on PHP scripts that run for less than 100ms most of the time. That would only be useful for cron/daemonize scripts.<br />
<br />
Memcached::OPT_CONNECT_TIMEOUT: the timeout after which a server is considered DEAD. As my servers are on the same LAN, ping is ~0.5ms, so 10ms is large enough to consider the server is DEAD. Note that you have to wait twice that time before a node is marked DEAD, so if it's 1000ms, your script will lock for 2 seconds before ignoring the DEAD server. That may affect your response times a lot, and that's why I've set it very low<br />
<br />
Author of this is Yvan from Dugwood</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102486""></a>
  <div class="note">
   <strong class="user">Michael Brenden</strong>
   <a href="#102486" class="date">17-Feb-2011 12:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
See the note for __construct()<br />
<br />
Important to not call -&gt;addServers() every run -- only call it if no servers exist (check getServerList() ); otherwise, since addServers() does not check for dups, it will let you add the same server again and again and again, resultings in hundreds if not thousands of connections to the MC daemon.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="memcached.addserver.html">Memcached::addServer</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="memcached.append.html">Memcached::append</a></div>
 <div class="up"><a href="class.memcached.html">Memcached</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
